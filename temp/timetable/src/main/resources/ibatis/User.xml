<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
    "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap>
	<select id="login" parameterClass="LoginInfo" resultClass="User">	
	    	SELECT major as major, stud_num as studentNum, email as email,
	    	user_level as userLevel, sex as sex
			FROM hufs_user
	        WHERE email = #email# AND passwd = #passwd#
	</select>
	
	<insert id="join" parameterClass="User">
		INSERT INTO "hufs_user"	(
    		email,
    		stud_num,
    		major,
    		sex
    	)
    	VALUES	(
    		#email#,
    		#studentNum#,
    		#major#,
    		#sex#
    	)
	</insert>
	
	<update id="editUser" parameterClass="User">
		UPDATE "hufs_user"
		SET stud_num = #studentNum#,
			major = #major#,
			sex = #sex#,
			user_level = #userLevel#
    	WHERE email = #email#
	</update>
	
	<update id="changePasswd" parameterClass="LoginInfo">
		UPDATE "hufs_user"
    	SET passwd = #passwd#
    	WHERE email = #email#
	</update>
	
	<sql id="searchParam_fragment">
	  <dynamic prepend="WHERE">
        	<isNotEmpty prepend="AND" property="major">
        		major = #major#
        	</isNotEmpty>
        	<isNotEmpty prepend="AND" property="studentNum">
        		stud_num = #studentNum#
        	</isNotEmpty>
        	<isNotEmpty prepend="AND" property="email">
        		email = #email#
        	</isNotEmpty>
        	<isNotEmpty prepend="AND" property="sex">
        		sex=#sex#
        	</isNotEmpty>
       		<isNotEqual prepend="AND" property="userLevel" compareValue="0">
       			user_level=#userLevel#
       		</isNotEqual>
        </dynamic>
	</sql>
	
	<select id="countOfUser" parameterClass="UserSearchParam" resultClass="Integer">
		SELECT COUNT(*)
		FROM hufs_user
		<include refid="searchParam_fragment"/>
	</select>
	
	<select id="getUser" parameterClass="java.lang.String" resultClass="User">	
	    	SELECT major as major, stud_num as studentNum, email as email,
	    	user_level as userLevel, sex as sex
			FROM hufs_user
	        WHERE email = #email#
	</select>
	
	<select id="getUsers" parameterClass="UserSearchParam" resultClass="User">
		SELECT major as major, stud_num as studentNum, email as email, user_level as userLevel, sex as sex
		FROM hufs_user
		<include refid="searchParam_fragment"/>
		ORDER BY user_no
		<dynamic prepend="FOR">
			<isNotEmpty prepend="AND" property="startRowNum">
	        	ORDERBY_NUM() >= #startRowNum#
	        </isNotEmpty>
	        <isNotEmpty prepend="AND" property="endRowNum">
	        	#endRowNum# >= ORDERBY_NUM()  
	        </isNotEmpty>
		</dynamic>
	</select>
</sqlMap>