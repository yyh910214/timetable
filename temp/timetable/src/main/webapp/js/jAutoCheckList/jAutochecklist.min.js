(function($,D){var E='jAutochecklist';var F=false;var G;if(!String.prototype.format){String.prototype.format=function(){var c=arguments;return this.replace(/{(\d+)}/g,function(a,b){return c[b]!==D?c[b]:a})}}$(window).on('mouseup.'+E,function(){F=false});var H={init:function(t){var u=$.extend(true,{width:200,listWidth:null,listMaxHeight:null,checkbox:false,dynamicPosition:false,fallback:false,firstItemSelectAll:false,multiple:true,showValue:false,popup:true,popupLogoAsValue:false,popupMaxItem:10,popupSizeDelta:100,textAllSelected:'All',textEmpty:'Please select...',textMoreItem:'and {0} more...',textNoResult:'No result found...',textSearch:'Type something...',selectorGroup:'group',selectorChild:'child',groupType:0,onClose:null,onItemClick:null,remote:{cache:true,loadMoreOnScroll:false,source:null,minLength:1,fnPredict:null,fnQuery:null}},t);if(!u.multiple){u.popup=false;u.firstItemSelectAll=false}return this.each(function(){var a=$(this);var b=a.data(E);var c=this.id;var d=this.className;var e=a.is('select');if(!a.is('ul')&&!e)return;if(b)return;var f=$.extend(true,{},u);if(e){f.multiple=this.multiple;if(!f.multiple){f.popup=false;f.firstItemSelectAll=false}}var g=a.data('json');if(g){f=$.extend(true,f,g)}var h=$('<div>').attr({'class':E+'_wrapper','tabindex':0}).width(f.width).append(('<div class="{0}_popup"></div>'+'<div class="{0}_dropdown_wrapper">'+'<div class="{0}_arrow"><div></div></div>'+'<div class="{0}_dropdown"><div class="{0}_result"></div><input class="{0}_prediction" /><input class="{0}_input" placeholder="{1}" /></div></div>'+'<ul class="{0}_list"></ul>').format(E,f.textSearch));if(d)h.addClass(d);if(c)h.attr('id',E+'_wrapper_'+c);if(!a.hasClass(E))a.addClass(E);var i=h.find('div.'+E+'_popup').width(f.width+f.popupSizeDelta).css({marginLeft:-f.popupSizeDelta/2});var j=h.find('div.'+E+'_dropdown');var k=h.find('div.'+E+'_result');var l=h.find('input.'+E+'_input');var m=h.find('input.'+E+'_prediction');var n=h.find('div.'+E+'_arrow');var o=h.find('ul.'+E+'_list');if(f.listWidth)o.width(f.listWidth*1-2);if(f.listMaxHeight)o.css({maxHeight:f.listMaxHeight+'px'});if(!f.popup){i.remove();i=null}var p;if(a.is('ul')){g=H._buildFromUl(a,f);p=a.data('name')}else{g=H._buildFromSelect(a,f);p=this.name}var q=H._buildFromJSON(g,f,p);var r=H._insertList(o,q,f);var s={popup:i,wrapper:h,dropdown:j,result:k,input:l,prediction:m,arrow:n,list:o,listItem:{li:r.li,checkbox:r.checkbox},selectAll:r.selectAll};b={elements:s,settings:f};a.data(E,b);a.after(h);a.hide();H._registerEvent(a);H._update(a);H._postProcessing(a)})},destroy:function(){return this.each(function(){var b=$(this);var c=b.data(E);if(!c)return;$(document).off('.'+E);c.elements.wrapper.remove();var d;if(b.is('ul')){d=b.children('li');c.elements.listItem.li.each(function(k,v){var a=$(this);d.eq(k).data('selected',a.hasClass('selected'))})}else{d=b.find('option,optgroup');c.elements.listItem.li.each(function(k,v){var a=$(this);d.eq(k).prop('selected',a.hasClass('selected'))})}b.removeData(E).show()})},selectAll:function(){return this.each(function(){H._selectAll($(this),true)})},deselectAll:function(){return this.each(function(){H._selectAll($(this),false)})},open:function(){return this.each(function(){H._open($(this))})},close:function(){return this.each(function(){H._close($(this))})},update:function(){return this.each(function(){H._update($(this))})},count:function(){return H._count($(this))},get:function(){return H._get($(this))},getAll:function(){return H._getAll($(this))},set:function(a,b){if(b===D)b=false;for(var i in a)a[i]=a[i].toString();return this.each(function(){H._set($(this),a,b)})},unset:function(a){for(var i in a)a[i]=a[i].toString();return this.each(function(){H._unset($(this),a)})},disable:function(){return this.each(function(){var a=$(this).data(E);var b=a.elements;b.wrapper.addClass(E+'_disabled')})},enable:function(){return this.each(function(){var a=$(this).data(E);var b=a.elements;b.wrapper.removeClass(E+'_disabled')})},settings:function(c){return this.each(function(){var a=$(this);var b=a.data(E);b.settings=$.extend(true,b.settings,c);a.data(E,b)})},buildFromJSON:function(g,h,i){return this.each(function(){var a=$(this);var b=a.data(E);if(!b)return;var c=b.elements;var d=b.settings;var e=H._buildFromJSON(g,d,a.data('name'));var f=H._insertList(c.list,e,d,h,i);b.elements.listItem={li:f.li,checkbox:f.checkbox};b.elements.selectAll=f.selectAll;a.data(E,b);H._update(a);H._postProcessing(a)})},_registerEvent:function(n){var o=n.data(E);var p=o.settings;var q=o.elements;var r=q.wrapper;var s=q.dropdown;var t=q.input;var u=q.prediction;var w=q.result;var x=q.list;var y=q.listItem.li;var z=q.listItem.checkbox;var A=q.selectAll;var B=q.popup;var C=false;t.on('keydown',function(e){var v=u.val();if(e.keyCode===9&&this.value!==v){this.value=v;return false}}).on('keyup.'+E,function(e){var f=$(this);var g=this.value;var h=true;var i=p.remote;var j;x.children('li.'+E+'_noresult').remove();if(g===''){u.val(null);y.show();h=false}else{if(i.source||i.fnQuery){var k=f.data('remote');if(!k)k=[];if(!k||k[g]===D){H._fetchData(n,g,0);if(i.fnPredict){i.fnPredict(g,u)}return}else{var l=k[g];if(l&&l.length){n.jAutochecklist('buildFromJSON',l,true);h=false}}}else{if(A)A.hide();var m=new RegExp(g,'i');y.each(function(){var a=$(this);var b=a.text();if(m.test(b)){a.show();h=false}else a.hide()});if(h)u.val(g);else{g=g.toLowerCase();y.filter(':visible').each(function(){var a=$(this);var b=a.text().toLowerCase();var c=b.indexOf(g);c+=g.length;var d=b.indexOf(' ',c);j=g+(d===-1?b.substr(c):b.substring(c,d));if(j!==g)return false});u.val(j)}}if(h)x.append('<li class="{0}_noresult">{1}</li>'.format(E,p.textNoResult))}}).on('focusin.'+E,function(e){e.stopPropagation()});if(B){s.on('mouseover.'+E,function(){clearTimeout(B.data('timeout'));if(H._count(n))B.fadeIn()});B.on('mouseover.'+E,function(){clearTimeout(B.data('timeout'))});s.add(B).on('mouseout.'+E,function(){if(x.is(':hidden')){var a=setTimeout(function(){B.hide()},200);B.data('timeout',a)}});B.on('click.'+E,'div',function(){var a=this.className.replace(E+'_popup_item_','');x.find('input.'+E+'_input'+a).prop('checked',false);H._update(n)})}x.on('click.'+E,'input.'+E+'_listItem_input',function(e){e.preventDefault()}).on('mousedown.'+E,'li.'+E+'_listItem',function(e){var a=$(this);if(a.hasClass('locked'))return false;var b;if(window.getSelection)b=window.getSelection().toString();else if(document.getSelection)b=document.getSelection();else if(document.selection)b=document.selection.createRange().text;if(b)return false;e.stopPropagation();var c=a.hasClass('selected');if(!F)G=[];G.push(a);if(F&&n.data('dragging_state')===c)return false;var d=a.children('input.'+E+'_listItem_input');var f=z.filter(':checked');var g=H._getValFromCheckboxes(f);c=!c;if(a.hasClass(E+'_checkall')){if(p.onItemClick){if(p.onItemClick(null,a,g,H._getAll(n))===false)return false}H._selectAll(n,c)}else{if(!p.multiple&&a.hasClass(p.selectorGroup))return false;var h=[];if(a.hasClass(p.selectorGroup)&&!a.hasClass('groupType2')){var j=H._getLevel(a);var k=H._getChildren(a,j,p.selectorChild);for(var i in k){h.push(k[i].children('input.'+E+'_listItem_input'))}}h.push(d);for(var i in h){if(h[i].prop('checked')===c)h[i]=null;else h[i].prop('checked',c)}if(p.onItemClick){if(p.onItemClick(d.prop('value'),a,g,H._get(n))===false){for(var i in h){if(h[i])h[i].prop('checked',!c)}return false}}H._update(n)}if(!p.multiple){setTimeout(function(){H._close(n)})}if(!F){F=true;n.data('dragging_state',c)}}).on('mouseenter.'+E,'li.'+E+'_listItem',function(){if(!F)return;var a=$(this);var i;var b=false;for(i in G){if(a.is(G[i])){b=true;break}}if(!b)$(this).trigger('mousedown')}).on('click.'+E,'a',function(e){e.stopPropagation()}).on('mousedown.'+E,'a',function(e){e.stopPropagation()}).on('scroll.'+E,function(){var a=p.remote;if(!a.loadMoreOnScroll)return;var b=$(this);if(b.height()+5<(b.get(0).scrollHeight-b.scrollTop()))return;var c=t.val();var d=$(this).children('li').length;H._fetchData(n,c,d)});w.on('mousedown.'+E,function(){if(x.is(':hidden')){H._open(n);setTimeout(function(){t.trigger('focus')})}else H._close(n)});r.on('focusin.'+E,function(){if(x.is(':hidden'))H._open(n);setTimeout(function(){t.trigger('focus')});y.filter('.over').removeClass('over')}).on('focusout.'+E,function(){setTimeout(function(){if(!$(document.activeElement).closest(r).length)H._close(n)})}).on('keydown.'+E,function(e){var a=e.keyCode;var b=y.filter('.over');var c;if(a===40||a===38){if(a===40)c=b.length?b.last().next():y.first();else c=b.length?b.first().prev():null;if(c&&c.length){if(!C){b.removeClass('over')}c.addClass('over');if(a===40&&c.position().top+c.height()>x.height())x.scrollTop(x.scrollTop()+50);else if(a===38&&c.position().top<0)x.scrollTop(x.scrollTop()-50)}}else if(a===13){if(!b.length){y.filter(':visible').first().trigger('mousedown').trigger('mouseup')}else{b.trigger('mousedown').trigger('mouseup')}t.val(null);return false}else if(a===16){C=true}}).on('keyup.'+E,function(e){var a=e.keyCode;if(a===16)C=false}).on('mouseup.'+E,function(e){F=false;e.stopPropagation()})},_fetchData:function(b,c,d){var e=b.data(E);var f=e.settings;var g=f.remote;var h=e.elements.input;var i=h.data('remote');if(c.length<g.minLength)return;if(g.fnQuery)g.fnQuery(b,c,d);else{$.getJSON(g.source,{text:c,offset:d},function(a){if(!a)a=[];b.jAutochecklist('buildFromJSON',a,true,d>0);if(g.cache&&d>0){i[c]=a;h.data('remote',i)}})}},_postProcessing:function(a){var b=a.data(E);var c=b.elements;var d=c.wrapper;var e=c.list;e.find('a,button,:input,object').attr('tabIndex',-1);var f=d.offset();var g=d.height();var x=f.left-$(window).scrollLeft();var y=f.top-$(window).scrollTop()+g;var w=e.width()+2;var h=e.height()+2;var i=$(window).width();var j=$(window).height();if(x+w>i)e.css({left:-(i-x)});if(b.settings.dynamicPosition&&y+h>j)e.css({top:-h-g-1})},_selectAll:function(a,b){var c=a.data(E);if(!c)return;c.elements.listItem.checkbox.prop('checked',b);this._update(a)},_update:function(h){var i=h.data(E);if(!i)return;var j=i.settings;var k=i.elements.listItem.li;var l=[];var m='';var n=0;var o=0;var p=true;k.each(function(){var a=$(this);if(a.hasClass(E+'_checkall'))return;if(a.hasClass(j.selectorGroup))H._updateParent(a,j);var b=a.children('input.'+E+'_listItem_input');if(!b.length)return;var c=b.prop('checked');var v=b.val();var d=j.showValue&&v!==''?v:a.text();if(c){if(j.popup){if(o>=j.popupMaxItem)n++;else if(!n){var e=b.attr('class').match(/input(\d+)/);var f=d;if(j.popupLogoAsValue){f='<img class="logo" src="{0}" />'.format(a.find('img.logo').attr('src'))}var g=E+'_popup_item_'+e[1];if(a.hasClass('locked'))g+=' locked';m+='<div class="{0}">{1}</div>'.format(g,f)}}a.addClass('selected');l.push(d);o++}else{a.removeClass('selected');p=false}});if(i.elements.selectAll){if(p)i.elements.selectAll.addClass('selected');else{i.elements.selectAll.removeClass('selected')}}if(j.popup){if(n)m+='<div class="{0}_more">'.format(E)+j.textMoreItem.format(n)+'</div>';i.elements.popup.html(m)}var q;if(l.length)q=j.textAllSelected&&p?j.textAllSelected:l.join(', ');else q='<span class="{0}_placeholder">{1}</span>'.format(E,i.settings.textEmpty);i.elements.result.html(q)},_open:function(a){var b=a.data(E);if(!b)return;var c=b.elements;var d=c.wrapper;if(d.hasClass(E+'_disabled'))return;var e=c.list;if(!c.list.is(':hidden'))return;c.result.hide();c.input.show();c.prediction.show();d.addClass(E+'_active');e.fadeIn();if(c.popup)c.popup.fadeIn();var f=$('ul.'+E).not(a);f.jAutochecklist('close')},_close:function(a){var b=a.data(E);if(!b)return;var c=b.elements;if(c.list.is(':hidden'))return;if(b.settings.onClose){if(b.settings.onClose(H._get(a))===false)return}if(c.popup)c.popup.hide();c.input.hide().val(null);c.prediction.hide().val(null);c.list.hide().children('li.'+E+'_noresult').remove();c.result.show();c.listItem.li.show();c.wrapper.removeClass(E+'_active')},_count:function(a){var b=a.data(E);if(!b)return 0;return b.elements.listItem.checkbox.filter(':checked').length},_get:function(a){var b=a.data(E);if(!b)return[];var c=[];b.elements.listItem.checkbox.filter(':checked').each(function(){c.push(this.value)});return c},_getAll:function(a){var b=a.data(E);if(!b)return[];var c=[];b.elements.listItem.checkbox.each(function(){c.push(this.value)});return c},_set:function(a,b,c){var d=a.data(E);if(!d)return;if(c)H._selectAll(a,false);d.elements.listItem.checkbox.each(function(){if(b.indexOf(this.value)!=-1)this.checked=true});H._update(a)},_unset:function(a,b){var c=a.data(E);if(!c)return;c.elements.listItem.checkbox.each(function(){if(b.indexOf(this.value)!=-1)this.checked=false});H._update(a)},_getLevel:function(a){var b=a.attr('class').match(/level(\d+)/);return b?b[1]:null},_getChildren:function(a,b,c){var d=a.next();if(!d.length)return[];var e=H._getLevel(d);if(e<b||(e==b&&(!d.hasClass(c))))d=null;return d?[d].concat(H._getChildren(d,b,c)):[]},_updateParent:function(a,b){var c=b.groupType;if(a.hasClass('groupType2'))c=2;else if(a.hasClass('groupType1'))c=1;else if(a.hasClass('groupType0'))c=0;if(c===2)return;var d=H._getLevel(a);var e=H._getChildren(a,d,b.selectorChild);var f;var g=a.children('input.'+E+'_listItem_input');if(c===0){var h=true;for(var i in e){if(e[i].children('input.'+E+'_listItem_input').prop('checked')===false){h=false;break}}}else{var h=false;for(var i in e){if(e[i].children('input.'+E+'_listItem_input').prop('checked')===true){h=true;break}}}if(h)a.addClass('selected');else a.removeClass('selected');g.prop('checked',h)},_getValFromCheckboxes:function(a){var b=[];a.each(function(){b.push(this.value)});return b},_buildFromUl:function(c,d){var e=[];c.children().each(function(){var t=$(this);var a=this.className||'';var b;if(a)b=H._getLevel(t);e.push({className:a,groupType:t.data('grouptype'),html:t.html(),isChild:(t.hasClass(d.selectorChild)),isGroup:t.hasClass(d.selectorGroup),level:b,locked:t.data('locked'),parentBound:t.data('parentbound'),selected:t.data('selected'),val:t.data('value')||''})});return e},_buildFromSelect:function(a,b){var c=[];a.children().each(function(){var t=$(this);if(t.is('optgroup')){c.push({className:this.className||'',groupType:t.data('grouptype'),html:this.label,isChild:false,isGroup:true,level:null,locked:false,selected:false,val:null});t.children().each(function(){c.push({className:this.className||'',groupType:0,html:this.innerHTML,isChild:true,isGroup:false,level:null,locked:t.data('locked'),selected:this.selected,val:this.hasAttribute('value')?this.value:''})})}else{c.push({className:this.className||'',groupType:0,html:this.innerHTML,isChild:false,isGroup:false,level:null,locked:t.data('locked'),selected:this.selected,val:this.hasAttribute('value')?this.value:''})}});return c},_buildFromJSON:function(a,b,c){if(!c)c=E;var d='';var i,e,val,n;var f=b.multiple?'checkbox':'radio';var g=0;for(i in a){e=a[i];val=(e.val===''||e.val===D||e.val===null)?'':e.val;var h=(e.className?e.className+' ':'')+E+'_listItem';var j=e.isGroup||false;if(e.groupType)h+=' groupType'+e.groupType;if(e.locked)h+=' locked';var k=5;if(e.level&&e.level>1){k+=(e.level-1)*20;h+=' level'+e.level}else h+=' level1';var l=[];if(j){if(val===''){h+=' '+E+'_listItem_group_empty ';if(b.checkbox)k+=15}}else if(e.isChild){h+=' '+E+'_listItem_child';k+=20;if(b.checkbox)k+=15}if(k>5)l.push('padding-left:'+k+'px');if(l.length)l='style="'+l.join(';')+'"';d+='<li class="{0}" {1}>'.format(h,l);if(!b.multiple&&!g)d+='<input type="hidden" name="{0}" value="" />'.format(c);if((!j||val!=='')&&(!b.firstItemSelectAll||i>0)){n=c;if(b.multiple){if(b.fallback){n+='['+g+']';d+='<input type="hidden" name="{0}" value="" />'.format(n)}else n+='[]'}d+='<input type="{0}" name="{1}" value="{2}" class="{3}_listItem_input {3}_input{5}" {4} />'.format(f,n,val,E,e.selected?'checked':'',g++)}d+=e.html+'</li>'}return d},_insertList:function(a,b,c,d,e){if(d&&!b){a.html('<li class="{0}_noresult">{1}</li>'.format(E,c.textNoResult));b=$()}else{if(e)a.append(b);else a.html(b);b=a.children();var f,checkbox;if(c.firstItemSelectAll)f=a.children(':first').addClass(E+'_checkall');checkbox=b.children('input.'+E+'_listItem_input');if(c.checkbox)checkbox.show()}return{li:b,checkbox:checkbox,selectAll:f}}};$.fn.jAutochecklist=function(a){if(H[a]){if(a.substr(0,1)==='_')$.error('Method '+a+' does not exist on jQuery.'+E);return H[a].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof a==='object'||!a){return H.init.apply(this,arguments)}else{$.error('Method '+a+' does not exist on jQuery.'+E)}}})(jQuery);